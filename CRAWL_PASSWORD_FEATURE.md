# URL爬取密码验证功能

## 📋 功能说明

添加了URL爬取功能的密码验证机制，只有在输入正确密码后才能进行URL爬取操作。

## ✅ 已实现的功能

### 1. 前端密码输入框
- ✅ 添加了密码输入框（类型为 `password`，输入时不显示字符）
- ✅ 密码输入框位于URL输入框下方
- ✅ 支持回车键快速提交

### 2. 前端验证
- ✅ 验证URL是否为空
- ✅ 验证密码是否为空
- ✅ 错误提示功能（显示红色错误消息）
- ✅ 成功提示功能（显示绿色成功消息）

### 3. 后端密码验证
- ✅ 从环境变量读取密码（`CRAWL_PASSWORD`）
- ✅ 验证密码是否正确
- ✅ 密码错误时返回403错误
- ✅ 密码正确时继续处理URL爬取

### 4. 更新的文件
- ✅ `static/index.html` - 静态前端页面
- ✅ `frontend/App.jsx` - React前端组件
- ✅ `web_server.py` - 后端API服务器
- ✅ `.env.example` - 环境变量示例文件

## 🔧 配置方法

### 步骤 1: 设置密码

在 `.env` 文件中添加爬取密码：

```bash
# 在项目根目录的 .env 文件中添加
CRAWL_PASSWORD=your-secure-password-here
```

**建议**：
- 使用强密码（包含大小写字母、数字、特殊字符）
- 不要将密码分享给未授权用户
- 定期更换密码

### 步骤 2: 重启服务器

修改环境变量后，需要重启服务器才能生效：

```bash
# 停止服务器
pkill -f web_server.py

# 重新启动
python3 web_server.py --mode user --port 8000
```

## 🎯 使用方式

### 用户界面操作

1. 在URL输入框中输入要爬取的URL
2. 在密码输入框中输入密码
3. 点击"Inject"按钮或按回车键提交

### 密码验证流程

```
用户输入URL和密码
    ↓
前端验证（URL和密码是否为空）
    ↓
发送到后端API (/api/upload/url)
    ↓
后端验证密码是否正确
    ↓
密码正确 → 开始爬取
密码错误 → 返回错误消息
```

## 🔒 安全说明

### 当前安全措施

1. **密码不在前端暴露**
   - 密码通过POST请求发送
   - 不在URL或日志中显示

2. **环境变量存储**
   - 密码存储在 `.env` 文件中
   - `.env` 文件应加入 `.gitignore`

3. **错误处理**
   - 密码错误时返回通用错误消息
   - 不泄露密码相关信息

### 安全建议

1. **使用HTTPS**
   - 在生产环境中使用HTTPS加密传输
   - 防止密码在传输过程中被窃取

2. **密码强度**
   - 使用强密码（至少12个字符）
   - 包含大小写字母、数字、特殊字符

3. **定期更换**
   - 定期更换密码
   - 如果密码泄露，立即更换

4. **访问控制**
   - 限制服务器访问权限
   - 使用防火墙保护服务器

## 📝 API接口说明

### POST /api/upload/url

**请求参数**（Form Data）：
- `url` (string, 必需): 要爬取的URL
- `password` (string, 可选): 爬取密码

**响应**：

成功（200）：
```json
{
  "status": "processing",
  "message": "URL received. Processing..."
}
```

密码错误（403）：
```json
{
  "detail": "密码错误，爬取被拒绝"
}
```

服务器未配置密码（500）：
```json
{
  "detail": "服务器未配置爬取密码，请联系管理员"
}
```

## 🛠️ 故障排除

### 问题 1: 提示"服务器未配置爬取密码"

**原因**：`.env` 文件中没有设置 `CRAWL_PASSWORD`

**解决**：
1. 检查 `.env` 文件是否存在
2. 在 `.env` 文件中添加 `CRAWL_PASSWORD=your-password`
3. 重启服务器

### 问题 2: 密码错误

**原因**：输入的密码与 `.env` 文件中的密码不匹配

**解决**：
1. 检查输入的密码是否正确
2. 检查 `.env` 文件中的密码设置
3. 确认密码前后没有多余空格

### 问题 3: 密码验证不工作

**原因**：服务器未加载环境变量

**解决**：
1. 确认 `.env` 文件在项目根目录
2. 确认服务器代码中已加载 `dotenv`
3. 重启服务器

## 📚 相关文件

- `static/index.html` - 静态前端页面（包含密码输入框）
- `frontend/App.jsx` - React前端组件（包含密码输入框）
- `web_server.py` - 后端API（包含密码验证逻辑）
- `.env.example` - 环境变量示例文件（包含密码配置说明）

## 🔄 更新日志

### v1.0 (当前版本)
- ✅ 添加密码输入框（前端）
- ✅ 添加密码验证逻辑（后端）
- ✅ 添加错误提示功能
- ✅ 更新环境变量配置文档
- ✅ 支持React前端组件
