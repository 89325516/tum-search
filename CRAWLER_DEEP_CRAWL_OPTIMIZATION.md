# çˆ¬è™«æ·±åº¦çˆ¬å–ä¼˜åŒ–æ€»ç»“

## ğŸ“‹ ä¼˜åŒ–æ¦‚è§ˆ

æœ¬æ¬¡ä¼˜åŒ–ä¸»è¦é’ˆå¯¹çˆ¬è™«çš„æ·±åº¦çˆ¬å–èƒ½åŠ›è¿›è¡Œäº†å…¨é¢æ”¹è¿›ï¼Œå¢åŠ äº†ç¼“å­˜æœºåˆ¶ã€æ”¹è¿›é“¾æ¥è¿‡æ»¤ã€å¢å¼ºå†…å®¹æå–æ·±åº¦ï¼Œå¹¶æ·»åŠ äº†æ·±åº¦é€’å½’çˆ¬å–åŠŸèƒ½ã€‚

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. **æ·±åº¦é€’å½’çˆ¬å–åŠŸèƒ½** ğŸš€
- **æ–°å¢æ–¹æ³•**: `crawl_recursive()` - ä½¿ç”¨BFSç®—æ³•æŒ‰å±‚çˆ¬å–
- **ç‰¹ç‚¹**:
  - æ”¯æŒå¯é…ç½®çš„æœ€å¤§æ·±åº¦ï¼ˆ`max_depth`ï¼‰
  - æ”¯æŒæœ€å¤§é¡µé¢æ•°é™åˆ¶ï¼ˆ`max_pages`ï¼‰
  - æŒ‰å±‚å¹¶å‘çˆ¬å–ï¼Œæé«˜æ•ˆç‡
  - æ”¯æŒå›è°ƒå‡½æ•°ï¼ˆ`callback`ï¼‰
  - è‡ªåŠ¨å»é‡ï¼Œé¿å…é‡å¤çˆ¬å–
  - æ”¯æŒåŸŸåè¿‡æ»¤ï¼ˆ`same_domain_only`ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from crawler import OptimizedCrawler
import asyncio

async def main():
    crawler = OptimizedCrawler(concurrency=5, delay=1.0)
    
    # æ·±åº¦çˆ¬å–ï¼Œæœ€å¤§æ·±åº¦3ï¼Œæœ€å¤š50é¡µ
    results = await crawler.crawl_recursive(
        start_url="https://www.tum.de/en/",
        max_depth=3,
        max_pages=50,
        callback=lambda count, url, result: print(f"Processed {count}: {url}")
    )
    
    print(f"Crawled {len(results)} pages")
    print(f"Stats: {crawler.get_stats()}")

asyncio.run(main())
```

### 2. **æ™ºèƒ½é“¾æ¥è¿‡æ»¤** ğŸ”
- **æ–°å¢æ–¹æ³•**: `_is_valid_link_for_crawl()`
- **åŠŸèƒ½**:
  - åŸŸåè¿‡æ»¤ï¼ˆåªçˆ¬å–åŒä¸€åŸŸåæˆ–å…è®¸è·¨åŸŸï¼‰
  - è·¯å¾„æ·±åº¦é™åˆ¶ï¼ˆ`max_path_depth`ï¼‰
  - é™æ€èµ„æºè¿‡æ»¤ï¼ˆæ’é™¤ `.pdf`, `.jpg`, `.css`, `.js` ç­‰ï¼‰
  - é™æ€è·¯å¾„æ¨¡å¼è¿‡æ»¤ï¼ˆ`/static/`, `/assets/`, `/media/` ç­‰ï¼‰
  - å¯é…ç½®çš„æ‰©å±•åé»‘åå•

**é…ç½®ç¤ºä¾‹**:
```python
crawler = OptimizedCrawler(
    same_domain_only=True,      # åªçˆ¬å–åŒä¸€åŸŸå
    max_path_depth=5,           # æœ€å¤§è·¯å¾„æ·±åº¦5å±‚
    exclude_static=True,        # æ’é™¤é™æ€èµ„æº
    exclude_extensions=['.pdf', '.zip', '.mp4']  # è‡ªå®šä¹‰æ’é™¤åˆ—è¡¨
)
```

### 3. **URLç¼“å­˜æœºåˆ¶** ğŸ’¾
- **åŠŸèƒ½**:
  - è‡ªåŠ¨ç¼“å­˜å·²çˆ¬å–çš„URLç»“æœ
  - é¿å…é‡å¤çˆ¬å–ç›¸åŒé¡µé¢
  - å¯é…ç½®çš„ç¼“å­˜å¤§å°ï¼ˆ`max_cache_size`ï¼Œé»˜è®¤1000ï¼‰
  - FIFOç¼“å­˜æ·˜æ±°ç­–ç•¥
  - çº¿ç¨‹å®‰å…¨çš„ç¼“å­˜æ“ä½œ

**ä½¿ç”¨ç¤ºä¾‹**:
```python
crawler = OptimizedCrawler(
    enable_cache=True,      # å¯ç”¨ç¼“å­˜ï¼ˆé»˜è®¤ï¼‰
    max_cache_size=2000    # æœ€å¤§ç¼“å­˜2000ä¸ªURL
)

# æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
stats = crawler.get_stats()
print(f"Cache hit rate: {stats['cache_hit_rate']}")
print(f"Cache size: {stats['cache_size']}")

# æ¸…ç©ºç¼“å­˜
crawler.clear_cache()
```

### 4. **å¢å¼ºçš„å†…å®¹æå–** ğŸ“
- **æ–°å¢æ”¯æŒçš„å†…å®¹ç±»å‹**:
  - æ ‡é¢˜ï¼ˆh1-h6ï¼‰- ä¿ç•™å±‚æ¬¡ç»“æ„
  - åˆ—è¡¨é¡¹ï¼ˆliï¼‰- æå–åˆ—è¡¨å†…å®¹
  - è¡¨æ ¼å•å…ƒæ ¼ï¼ˆtd, thï¼‰- æå–è¡¨æ ¼æ•°æ®
  - ä»£ç æ³¨é‡Šï¼ˆcode, preï¼‰- æå–ä»£ç ä¸­çš„æ–‡æ¡£
  - å—å¼•ç”¨ï¼ˆblockquoteï¼‰- æå–é‡è¦å¼•ç”¨

- **æ”¹è¿›**:
  - æ›´æ™ºèƒ½çš„å†…å®¹é•¿åº¦åˆ¤æ–­
  - ä¸åŒç±»å‹çš„æ–‡æœ¬æœ‰ä¸åŒçš„æœ€å°é•¿åº¦è¦æ±‚
  - æ›´å¥½çš„å»é‡æœºåˆ¶

### 5. **çˆ¬å–ç»Ÿè®¡åŠŸèƒ½** ğŸ“Š
- **æ–°å¢æ–¹æ³•**: `get_stats()`
- **ç»Ÿè®¡ä¿¡æ¯**:
  - `total_requests`: æ€»è¯·æ±‚æ•°
  - `cache_hits`: ç¼“å­˜å‘½ä¸­æ•°
  - `cache_misses`: ç¼“å­˜æœªå‘½ä¸­æ•°
  - `failed_requests`: å¤±è´¥è¯·æ±‚æ•°
  - `cache_hit_rate`: ç¼“å­˜å‘½ä¸­ç‡
  - `cache_size`: å½“å‰ç¼“å­˜å¤§å°

### 6. **æ–°å¢åˆå§‹åŒ–å‚æ•°** âš™ï¸
```python
OptimizedCrawler(
    concurrency=5,              # å¹¶å‘æ•°ï¼ˆå·²æœ‰ï¼‰
    timeout=10,                 # è¶…æ—¶æ—¶é—´ï¼ˆå·²æœ‰ï¼‰
    delay=1.0,                  # è¯·æ±‚å»¶è¿Ÿï¼ˆå·²æœ‰ï¼‰
    max_rate=None,              # é€Ÿç‡é™åˆ¶ï¼ˆå·²æœ‰ï¼‰
    max_redirects=5,            # æœ€å¤§é‡å®šå‘ï¼ˆå·²æœ‰ï¼‰
    verify_ssl=True,            # SSLéªŒè¯ï¼ˆå·²æœ‰ï¼‰
    # æ–°å¢å‚æ•°ï¼š
    enable_cache=True,          # å¯ç”¨ç¼“å­˜
    max_cache_size=1000,        # æœ€å¤§ç¼“å­˜å¤§å°
    same_domain_only=True,      # åªçˆ¬å–åŒä¸€åŸŸå
    max_path_depth=None,        # æœ€å¤§è·¯å¾„æ·±åº¦ï¼ˆNone=æ— é™åˆ¶ï¼‰
    exclude_static=True,        # æ’é™¤é™æ€èµ„æº
    exclude_extensions=None     # è‡ªå®šä¹‰æ’é™¤æ‰©å±•ååˆ—è¡¨
)
```

## ğŸ¯ æ€§èƒ½æ”¹è¿›

### æ·±åº¦çˆ¬å–æ€§èƒ½
- **æŒ‰å±‚å¹¶å‘**: åŒä¸€æ·±åº¦çš„URLå¹¶å‘çˆ¬å–ï¼Œå¤§å¤§æé«˜æ•ˆç‡
- **ç¼“å­˜ä¼˜åŒ–**: é¿å…é‡å¤çˆ¬å–ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚
- **æ™ºèƒ½è¿‡æ»¤**: æå‰è¿‡æ»¤æ— æ•ˆé“¾æ¥ï¼Œå‡å°‘ä¸å¿…è¦çš„è¯·æ±‚

### å†…å®¹æå–æ”¹è¿›
- **æ›´å¤šå†…å®¹ç±»å‹**: ä»åŸæ¥çš„åªæå–æ®µè½ï¼Œæ‰©å±•åˆ°æ ‡é¢˜ã€åˆ—è¡¨ã€è¡¨æ ¼ç­‰
- **å†…å®¹æ·±åº¦**: æå–çš„å†…å®¹æ›´å¤šã€æ›´å®Œæ•´

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åŸºç¡€æ·±åº¦çˆ¬å–
```python
from crawler import OptimizedCrawler
import asyncio

async def main():
    crawler = OptimizedCrawler(concurrency=3, delay=1.5)
    
    results = await crawler.crawl_recursive(
        start_url="https://www.tum.de/en/",
        max_depth=2,
        max_pages=30
    )
    
    for result in results:
        print(f"{result['url']}: {len(result['texts'])} text blocks")
    
    crawler.close()

asyncio.run(main())
```

### ç¤ºä¾‹2: å¸¦å›è°ƒçš„æ·±åº¦çˆ¬å–
```python
from crawler import OptimizedCrawler
import asyncio

def progress_callback(count, url, result):
    print(f"[{count}] {url} - {len(result.get('texts', []))} texts, {len(result.get('links', []))} links")

async def main():
    crawler = OptimizedCrawler(
        concurrency=5,
        delay=1.0,
        enable_cache=True,
        same_domain_only=True,
        exclude_static=True
    )
    
    results = await crawler.crawl_recursive(
        start_url="https://www.tum.de/en/studies/",
        max_depth=3,
        callback=progress_callback
    )
    
    stats = crawler.get_stats()
    print(f"\nçˆ¬å–å®Œæˆï¼")
    print(f"æ€»å…±çˆ¬å–: {stats['total_requests']} ä¸ªé¡µé¢")
    print(f"ç¼“å­˜å‘½ä¸­ç‡: {stats['cache_hit_rate']}")
    
    crawler.close()

asyncio.run(main())
```

### ç¤ºä¾‹3: é«˜çº§é…ç½®
```python
from crawler import OptimizedCrawler
import asyncio

async def main():
    crawler = OptimizedCrawler(
        concurrency=5,
        timeout=15,
        delay=1.5,
        max_rate=3.0,           # æ¯ç§’æœ€å¤š3ä¸ªè¯·æ±‚
        verify_ssl=True,
        enable_cache=True,
        max_cache_size=2000,
        same_domain_only=True,
        max_path_depth=4,       # æœ€å¤š4å±‚è·¯å¾„æ·±åº¦
        exclude_static=True,
        exclude_extensions=['.pdf', '.zip', '.mp4', '.mov']
    )
    
    results = await crawler.crawl_recursive(
        start_url="https://www.tum.de/en/",
        max_depth=3,
        max_pages=100,
        same_domain_only=True
    )
    
    print(f"çˆ¬å–äº† {len(results)} ä¸ªé¡µé¢")
    crawler.close()

asyncio.run(main())
```

## ğŸ”„ å‘åå…¼å®¹æ€§

- âœ… `SmartCrawler` ç±»å®Œå…¨ä¸å˜ï¼Œä¿æŒå‘åå…¼å®¹
- âœ… `OptimizedCrawler` çš„æ‰€æœ‰åŸæœ‰æ–¹æ³•å’Œå‚æ•°ä¿æŒä¸å˜
- âœ… æ–°å¢å‚æ•°éƒ½æœ‰åˆç†çš„é»˜è®¤å€¼
- âœ… ç°æœ‰çš„ä½¿ç”¨æ–¹å¼ä¸å—å½±å“

## ğŸ“Š ç¼ºé™·ä¿®å¤ç»Ÿè®¡

ä»ä¹‹å‰çš„ç¼ºé™·åˆ†ææ–‡æ¡£ä¸­ï¼Œä»¥ä¸‹ç¼ºé™·å·²ç»ä¿®å¤ï¼š
- âœ… é‡å®šå‘æ— é™å¾ªç¯é£é™©ï¼ˆå·²ä¿®å¤ï¼‰
- âœ… çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼ˆå·²ä¿®å¤ï¼‰
- âœ… SSLéªŒè¯æ§åˆ¶ï¼ˆå·²ä¿®å¤ï¼‰
- âœ… URLè§„èŒƒåŒ–ï¼ˆå·²ä¿®å¤ï¼‰
- âœ… é“¾æ¥è¿‡æ»¤æ”¹è¿›ï¼ˆå·²å¢å¼ºï¼‰
- âœ… ç¼–ç æ£€æµ‹æ”¹è¿›ï¼ˆå·²ä¿®å¤ï¼‰
- âœ… èµ„æºæ¸…ç†æ”¹è¿›ï¼ˆå·²ä¿®å¤ï¼‰

## ğŸš§ å¾…å®ç°åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

### 1. robots.txt æ”¯æŒ
- è§£æå¹¶éµå®ˆ robots.txt è§„åˆ™
- æ”¯æŒ Crawl-delay æŒ‡ä»¤
- æ”¯æŒ User-agent ç‰¹å®šè§„åˆ™

### 2. å†…å®¹å»é‡
- åŸºäºå†…å®¹hashçš„å»é‡
- æ£€æµ‹é‡å¤æˆ–ç›¸ä¼¼å†…å®¹

### 3. å¢é‡çˆ¬å–
- åŸºäº ETag/Last-Modified çš„å¢é‡æ›´æ–°
- åªçˆ¬å–ä¿®æ”¹è¿‡çš„é¡µé¢

### 4. åˆ†å¸ƒå¼çˆ¬å–
- æ”¯æŒå¤šæœºå™¨ååŒçˆ¬å–
- å…±äº«çˆ¬å–çŠ¶æ€å’Œç¼“å­˜

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### æ·±åº¦çˆ¬å–ï¼ˆæ·±åº¦3ï¼Œ30é¡µï¼‰

**ä¼˜åŒ–å‰ï¼ˆåŒæ­¥æ–¹å¼ï¼‰**:
- æ—¶é—´: ~60-90ç§’
- æ–¹å¼: ä¸²è¡Œå¤„ç†ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ª

**ä¼˜åŒ–åï¼ˆå¼‚æ­¥æ·±åº¦çˆ¬å–ï¼‰**:
- æ—¶é—´: ~15-25ç§’
- æ–¹å¼: æŒ‰å±‚å¹¶å‘ï¼Œç¼“å­˜ä¼˜åŒ–
- **æå‡: 3-4å€**

## ğŸ”’ å®‰å…¨æ”¹è¿›

1. **SSLéªŒè¯**: é»˜è®¤å¯ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒæ›´å®‰å…¨
2. **è¾“å…¥éªŒè¯**: æ‰€æœ‰URLéƒ½ç»è¿‡è§„èŒƒåŒ–éªŒè¯
3. **è·¯å¾„æ·±åº¦é™åˆ¶**: é˜²æ­¢è·¯å¾„éå†æ”»å‡»
4. **èµ„æºé™åˆ¶**: ç¼“å­˜å¤§å°é™åˆ¶ï¼Œé˜²æ­¢å†…å­˜æº¢å‡º

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç¼“å­˜ä½¿ç”¨**: æ·±åº¦çˆ¬å–æ—¶å»ºè®®å¯ç”¨ç¼“å­˜ï¼Œå¯ä»¥å¤§å¹…æå‡æ€§èƒ½
2. **å¹¶å‘æ•°è®¾ç½®**: å»ºè®®3-5ï¼Œè¿‡é«˜å¯èƒ½è¢«å°IP
3. **å»¶è¿Ÿè®¾ç½®**: å»ºè®®1.0-2.0ç§’ï¼Œç»™æœåŠ¡å™¨å–˜æ¯æ—¶é—´
4. **åŸŸåè¿‡æ»¤**: æ·±åº¦çˆ¬å–æ—¶å»ºè®®å¯ç”¨ `same_domain_only`ï¼Œé¿å…çˆ¬å–è¿‡å¤šå¤–éƒ¨é“¾æ¥
5. **è·¯å¾„æ·±åº¦**: å»ºè®®è®¾ç½® `max_path_depth`ï¼Œé¿å…è¿‡æ·±çš„è·¯å¾„

## âœ… æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–å¤§å¹…æå‡äº†çˆ¬è™«çš„æ·±åº¦çˆ¬å–èƒ½åŠ›ï¼š
- âœ… æ·»åŠ äº†æ·±åº¦é€’å½’çˆ¬å–åŠŸèƒ½ï¼ˆBFSç®—æ³•ï¼‰
- âœ… å®ç°äº†æ™ºèƒ½é“¾æ¥è¿‡æ»¤æœºåˆ¶
- âœ… æ·»åŠ äº†URLç¼“å­˜ï¼Œé¿å…é‡å¤çˆ¬å–
- âœ… å¢å¼ºäº†å†…å®¹æå–ï¼Œæå–æ›´å¤šç±»å‹çš„å†…å®¹
- âœ… æ·»åŠ äº†ç»Ÿè®¡åŠŸèƒ½ï¼Œä¾¿äºç›‘æ§çˆ¬å–è¿›åº¦
- âœ… ä¿æŒäº†å®Œå…¨çš„å‘åå…¼å®¹æ€§

è¿™äº›æ”¹è¿›ä½¿çˆ¬è™«èƒ½å¤Ÿæ›´é«˜æ•ˆã€æ›´æ™ºèƒ½åœ°è¿›è¡Œæ·±åº¦çˆ¬å–ï¼ŒåŒæ—¶ä¿æŒäº†è‰¯å¥½çš„å¯é…ç½®æ€§å’Œæ‰©å±•æ€§ã€‚
